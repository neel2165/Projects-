<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard | Attendance & Exams</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap');
  
  :root {
    --bg-dark: #0a0a0a;
    --bg-secondary: #121212;
    --text-primary: #eee;
    --text-secondary: #bbb;
    --accent-purple: #6e57f3;
    --shadow-dark: rgba(0, 0, 0, 0.8);
    --shadow-light: rgba(255, 255, 255, 0.1);
  }
  
  * {
    box-sizing: border-box;
  }
  
  body {
    margin: 0;
    min-height: 100vh;
    background: var(--bg-dark);
    font-family: 'Poppins', sans-serif;
    color: var(--text-primary);
    padding: 40px 30px;
  }
  
  h1 {
    font-size: 3rem;
    margin-bottom: 30px;
    letter-spacing: 6px;
    color: var(--accent-purple);
    text-shadow:
      0 0 10px var(--accent-purple),
      0 0 25px #3f2a8c;
    user-select: none;
  }
  
  nav {
    margin-bottom: 40px;
  }
  
  nav a {
    text-decoration: none;
    font-weight: 700;
    color: var(--text-primary);
    background: linear-gradient(145deg, var(--accent-purple), #3f2a8c);
    padding: 12px 28px;
    margin: 0 15px 0 0;
    border-radius: 30px;
    box-shadow:
      5px 5px 15px var(--shadow-dark),
      -5px -5px 15px var(--shadow-light);
    transition: all 0.3s ease;
  }
  
  nav a:hover {
    background: linear-gradient(145deg, #3f2a8c, var(--accent-purple));
    box-shadow:
      inset 5px 5px 15px var(--shadow-dark),
      inset -5px -5px 15px var(--shadow-light);
  }
  
  .container {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(320px,1fr));
    gap: 30px;
  }
  
  .card {
    background: var(--bg-secondary);
    border-radius: 24px;
    box-shadow:
      10px 10px 30px var(--shadow-dark),
      -10px -10px 30px var(--shadow-light);
    padding: 25px 30px;
  }
  
  .card h2 {
    margin-top: 0;
    margin-bottom: 20px;
    color: var(--accent-purple);
    text-shadow:
      0 0 8px var(--accent-purple),
      0 0 18px #3f2a8c;
    user-select: none;
  }
  
  /* Attendance Chart container */
  #attendanceChart {
    width: 100%;
    height: 280px;
  }
  
  /* Upcoming Exams List */
  ul.exam-list {
    list-style: none;
    padding-left: 0;
  }
  
  ul.exam-list li {
    background: rgba(255 255 255 / 0.05);
    padding: 15px 20px;
    margin-bottom: 14px;
    border-radius: 14px;
    box-shadow:
      inset 2px 2px 5px rgba(255 255 255 / 0.1),
      inset -2px -2px 5px rgba(0 0 0 / 0.3);
    display: flex;
    justify-content: space-between;
    color: var(--text-primary);
  }
  
  ul.exam-list li span.date {
    font-weight: 700;
    color: var(--accent-purple);
  }
  
  /* Faculty Table */
  table {
    width: 100%;
    border-collapse: collapse;
    color: var(--text-primary);
  }
  
  th, td {
    padding: 14px 18px;
    text-align: left;
  }
  
  thead {
    background: linear-gradient(135deg, #3f2a8c, var(--accent-purple));
    color: white;
    border-radius: 20px;
  }
  
  tbody tr:nth-child(even) {
    background: rgba(255 255 255 / 0.05);
  }
  
  tbody tr:hover {
    background: rgba(255 255 255 / 0.12);
    transition: background 0.3s ease;
  }
  
</style>
</head>
<body>
  <h1>DASHBOARD</h1>
  <nav>
    <a href="{{ url_for('results') }}">Results</a>
    <a href="{{ url_for('logout') }}">Logout</a>
  </nav>
  
  <div class="container">
    <!-- Attendance Card -->
    <div class="card">
      <h2>Attendance Summary</h2>
      <canvas id="attendanceChart"></canvas>
    </div>
  
    <!-- Upcoming Exams Card -->
    <div class="card">
      <h2>Upcoming Exams</h2>
      <ul class="exam-list">
        {% for exam in exams %}
          <li>
            <span class="subject">{{ exam.subject }}</span>
            <span class="date">{{ exam.date }}</span>
          </li>
        {% else %}
          <li>No upcoming exams</li>
        {% endfor %}
      </ul>
    </div>
  
    <!-- Faculty Card -->
    <div class="card">
      <h2>Faculty & Subjects</h2>
      <table>
        <thead>
          <tr>
            <th>Faculty Name</th>
            <th>Subject</th>
          </tr>
        </thead>
        <tbody>
          {% for faculty in faculties %}
          <tr>
            <td>{{ faculty.name }}</td>
            <td>{{ faculty.subject }}</td>
          </tr>
          {% else %}
          <tr><td colspan="2">No faculty data</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

<!-- Student Eligibility Card -->
<div class="card" style="grid-column: 1 / -1;">
  <h2>Student Attendance & Eligibility</h2>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Roll</th>
        <th>DM</th>
        <th>SE</th>
        <th>IS</th>
        <th>ASP.NET</th>
        <th>PHP</th>
        <th>Eligibility</th>
      </tr>
    </thead>
    <tbody>
      {% for student in students %}
      <tr>
        <td>{{ student.name }}</td>
        <td>{{ student.roll }}</td>
        <td>{{ student.attendance.DM }}%</td>
        <td>{{ student.attendance.SE }}%</td>
        <td>{{ student.attendance.IS }}%</td>
        <td>{{ student.attendance['ASP.NET'] }}%</td>
        <td>{{ student.attendance.PHP }}%</td>
        <td>
          {% if student.attendance.DM < 75
              or student.attendance.SE < 75
              or student.attendance.IS < 75
              or student.attendance['ASP.NET'] < 75
              or student.attendance.PHP < 75 %}
            ❌ Not Eligible
          {% else %}
            ✅ Eligible
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const attendanceData = {
      labels: {{ attendance_labels|tojson }},
      datasets: [{
        label: 'Attendance %',
        data: {{ attendance_values|tojson }},
        backgroundColor: 'rgba(110, 87, 243, 0.7)',
        borderColor: '#6e57f3',
        borderWidth: 2,
        borderRadius: 8,
        hoverBackgroundColor: 'rgba(110, 87, 243, 0.9)',
        maxBarThickness: 50,
      }]
    };
  
    const config = {
      type: 'bar',
      data: attendanceData,
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            max: 100,
            ticks: {
              stepSize: 10,
              color: '#eee'
            },
            grid: {
              color: 'rgba(255,255,255,0.1)'
            }
          },
          x: {
            ticks: {
              color: '#eee'
            },
            grid: {
              display: false
            }
          }
        },
        plugins: {
          legend: {
            labels: {
              color: '#eee'
            }
          }
        }
      }
    };
  
    new Chart(
      document.getElementById('attendanceChart'),
      config
    );
  </script>
</body>
</html>
